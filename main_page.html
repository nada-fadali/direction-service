<!DOCTYPE html>
<html>
	<head>
		<title>Nada's Navigator</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
   		<meta charset="utf-8">
        <meta name="author" content="Nada Fadali">

		<link rel="stylesheet" type="text/css" href="css/main.css" />
        <style type="text/css">
            #map{
                height: 420px; 
                margin-bottom:20px;
            }

            input{
                color: #FFF;
                background-color: #8DC2A1;
                border:1px solid #658A73;
                -moz-box-shadow: inset 0 0 5px #769B84;
                -webkit-box-shadow: inset 0 0 5px #769B84;
                box-shadow: inset 0 0 5px #769B84;
            }
            input:hover {
                background-color: #82AD92;
            }
        </style>

		<!-- JQuery && navigator bar animation script -->
		<script src='js/jquery-2.1.1.min.js'></script>
		<script src='js/nav.js'></script>

	</head>
	
	<body>
		<div id="header">
			<div id="t">and you shall have directions</div><br>
			<div id="nav">
				|<a href="main_page.html">home</a>
				|<a href="about.html#t">about</a>
				|<a href="main_page.html#map">map</a> |
			</div>
		</div>

		<div id="container">
			<center><big><b>Nada's Navigator</b></big></center>
            <p>
                Hello, my name is <b>Nada</b> and this is my project for DMET601 Web Technologies and Utitlties course at the German University in Cairo. It's a direction service that shows on the map the shortest driving route between two streets.
            </p>
            <p>
                Bellow is a <a href="main_page.html#map">map</a>centered on <b>Nasr City</b>. You may click on the two streets you wish to view the shortest driving route between them (two streets must be from the list of the available streets).
            </p>
            <br>
            <p>
                &nabla; The streets available are
                <ul>
                    <li>Hassen Kamel</li>
                    <li>El Orooba</li>
                    <li>Suez Road</li>
                    <li>Salah Salem</li>
                    <li>El Nozha</li>
                    <li>Nasr Road</li>
                    <li>El Mokhaym EL Daem</li>
                    <li>Yussef Abbas</li>
                    <li>El Tayaraan</li>
                    <li>Abbas EL Akkad</li>
                    <li>Makram Abed</li>
                    <li>Hassan El Maamoon</li>
                    <li>Mostafa EL Nahaas</li>
                    <li>Ali Amin</li>
                    <li>EL Khalyfa El Zahar</li>
                    <li>Hassan El Shrief</li>
                    <li>Mahdy Arafa</li>
                    <li>Zaker Hassen</li>
                    <li>Ahmed EL Zomor</li>
                    <li>El Waffaa w EL Amaal</li>
                </ul>
            </p>
            <br>
            <p>&nabla; Please Click on the two locations</p>
			
			<div id="map"></div>

            <div style="float:right;">
                <input id="btnClearPt1" type="button" value="Clear red Point" 
                onclick="clearPt(1);" style="font-size:11px;" >

                <input id="btnCLearpt2" type="button" value="Clear blue Point" 
                onclick="clearPt(0);" style="font-size:11px;">
            </div>

            <input id="btn" type="button" value="Show Directions">
		</div>


        <div id="credit">NF<br>Theme by: Nada Fadali</div>
	</body>	


    <!-- 
        google maps api 
    -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script type="text/javascript">
        var map;

        //flags to render markers
        var f1 = true;
        var f2 = true;


        //markers 
        var pt1 = new google.maps.Marker({title:'Point 1'});
        var pt2 = new google.maps.Marker({title:'Point 2', icon: 'css/blue-icon.png'});

        function initialize() {
            /*
            *   Map intialization
            */
            var mapOptions = {
                zoom: 14,
                center: new google.maps.LatLng(30.067543,31.345868)
            };
            map = new google.maps.Map(document.getElementById('map'),
                mapOptions);

            /*
            *   Click event
            */
            google.maps.event.addListener(map, 'click', function(event){
                if (!f1 && !f2) {
                    alert("Only two locations!");
                } 
                else {
                    if (f1) {
                        f1 = false;
                        pt1.setMap(map);
                        pt1.setPosition(event.latLng);
                    }
                       
                    else if (f2){
                        f2 = false;  
                        pt2.setMap(map);
                        pt2.setPosition(event.latLng);
                    } 
                }
            });

            /*
            * create database of the nodes
            */
            $(document).ready(function(){
                $.ajax({
                    url: 'php/db.php',
                    success:function(data){
                        //user isn't suppose to see this alert
                        //this is just to show that the database I'm trying to create already exists
                        //and so needed to be changed in the code
                        //alert(data);
                    }
                });
            });

            /*
            *   click event
            *   takes input points and return shortest path
            */
            $('#btn').click(function(){
                if (f1 || f2) {
                    alert("Please Choose two locations!")
                }  
                else{ 
                    $.ajax({
                        url:'php/ds.php',
                        type:'post',
                        //dataType:'html',
                        data:{
                            lat1:pt1.getPosition().lat()+'', 
                            lng1:pt1.getPosition().lng()+'',
                            lat2:pt2.getPosition().lat()+'',
                            lng2:pt2.getPosition().lng()+''
                        },
                        success:function(data){
                            //alert(data);

                            /*
                            *   Render Path
                            */
                            var nc = [
                                new google.maps.LatLng(pt1.getPosition().lat(), pt1.getPosition().lng())
                            ];
                            
                            var s = data.split(" "); 
                            for (var i = 0; i < s.length-1; i+=2) {
                                var lat = parseFloat(s[i]);
                                var lng = parseFloat(s[i+1]);
                                //  node markers
                                var n = new google.maps.Marker({
                                    map: map,
                                    position: new google.maps.LatLng(lng, lat),
                                    icon: 'css/yellow-dot.png'
                                });
                                nc.push(
                                    new google.maps.LatLng(n.getPosition().lat(), n.getPosition().lng())
                                );
                            };
                            nc.push(
                                new google.maps.LatLng(pt2.getPosition().lat(), pt2.getPosition().lng())
                            );

                            //  path line
                            new google.maps.Polyline({
                                path: nc,
                                map: map,
                                strokeColor: '#4F6B5A',
                                strokeOpacity: 0.8,
                                strokeWeight: 4
                            });


                            /*
                            *   Create Direction files
                            */
                        }
                    });
                }
            });

        }

        google.maps.event.addDomListener(window, 'load', initialize);
        
        
        
        /*
        * Clear points on the map
        */
        function clearPt(i){
            if (i == 1) {
                pt1.setMap(null);  
                f1 = true; 
            }
            else {
                pt2.setMap(null);
                f2 = true;
            }
        }

    </script>
</html>